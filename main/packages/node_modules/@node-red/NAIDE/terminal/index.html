<!--
/*=====================================================
    Title.   Terminal : index.html
    ------------------------------------------
    Author.  K9714 (kskim.hci@gmail.com)
    Date.    2019. 10. 28
    ------------------------------------------
    Desc.
        웹 페이지에서 Terminal 테스트를 할 수 있는
        HTML 문서입니다.
=====================================================*/
-->
<!DOCTYPE html>
<html>
    <head>
        <!-- HTML 서버로 해당 소스 요청 -->
        <link rel="stylesheet" href="xterm/css/xterm.css" />
        <script src="/socket.io/socket.io.js"></script>
        <script src="xterm/lib/xterm.js"></script>
    </head>
    <body>
        <div id="terminal"></div>
        <script>
            // xterm.js 의 Terminal 클래스 선언
            var term = new Terminal();
            term.open(document.getElementById('terminal'));
            // 서버로 연결, 인자값이 없으면 현재 접속 주소로 연결
            var socket = io();
            // 서버로부터 요청을 받는 이벤트
            socket.on('data', function(data) {
                // xterm에 받은 데이터를 string 형식일 경우 씀
                if (typeof(data) == "string")
                    term.write(data);
            });
            // xterm API - onKey
            // xterm이 활성화 상태이면서 한글이 아닌 키가 눌렸을 경우 객체를 반환함
            // 객체의 key 요소는 입력한 키 이름이 string 형식으로 들어있음
            term.onKey(function(obj){
                // Enter키의 경우 '\r' 을 반환하므로 new line 추가 변환 
                var key = obj.key == '\r' ? '\r\n' : obj.key;
                // 최종적으로 key string을 서버로 전송
                socket.emit('data', key);
            });
        </script>
    </body>
</html>